[
["integration.html", "Lesson 3 Integration 3.1 Time series plot of satellite &amp; sentiment metrics 3.2 Box plot of satellite &amp; sentiment metrics before/after lockdown References", " Lesson 3 Integration 3.1 Time series plot of satellite &amp; sentiment metrics Let’s now integrate data from satellite and sentiment into the same monthly time series plot, first rescaling all metrics -1 to 1 for comparison. library(here) library(glue) library(readr) library(dplyr) library(lubridate) library(scales) library(ggplot2) library(plotly) # paths loc_name &lt;- &quot;delhi&quot; satellite_csv &lt;- here(glue(&quot;data/no2_{loc_name}_ee-chart.csv&quot;)) sentiments_csv &lt;- here(glue(&quot;data/sentiments_{loc_name}.csv&quot;)) metrics_csv &lt;- here(glue(&quot;data/metrics_{loc_name}.csv&quot;)) if (!file.exists(metrics_csv)){ sentiments &lt;- read_csv(sentiments_csv) %&gt;% rename(date = ym_date) %&gt;% mutate( metric = glue(&quot;{query_name}&quot;), sentiment = tf_score) %&gt;% select(metric, date, sentiment) satellite &lt;- read_csv(satellite_csv) %&gt;% transmute( date = mdy(`system:time_start`) %&gt;% floor_date(date, unit = &quot;month&quot;), no2 = NO2_column_number_density) %&gt;% group_by(date) %&gt;% summarize( no2 = mean(no2, na.rm=T)) %&gt;% mutate( metric = &quot;NO2&quot;, sentiment = rescale(no2, to = range(sentiments$sentiment))) %&gt;% select(metric, date, no2, sentiment) bind_rows( satellite, sentiments) %&gt;% write_csv(metrics_csv) } metrics &lt;- read_csv(metrics_csv) no2 &lt;- metrics %&gt;% filter(metric == &quot;NO2&quot;) %&gt;% pull(no2) g &lt;- metrics %&gt;% ggplot( aes(x = date, y = sentiment, color = metric)) + geom_line() + scale_y_continuous( sec = sec_axis( ~rescale(., range(no2)), name = bquote(NO[2]~&quot;(µmol/&quot;~m^2~&quot;)&quot;))) + theme(legend.position=&quot;top&quot;) g ggplotly(g) Interesting! The air quality sentiment (red line) does seem to be inversely correlated with nitrogen dioxide (NO2; blue line). The sentiment for clean energy (green line) seems to correlate with satellite NO2 until 2019-03 then remains relatively steady. 3.2 Box plot of satellite &amp; sentiment metrics before/after lockdown Let’s compare averages before and after lockdown March 24, 2020. date_lockdown &lt;- as.Date(&quot;2020-03-24&quot;) metrics_ba &lt;- bind_rows( metrics %&gt;% filter(date &lt;= date_lockdown) %&gt;% mutate( period = &quot;before&quot;), metrics %&gt;% filter(date &gt; date_lockdown) %&gt;% mutate( period = &quot;after&quot;)) %&gt;% mutate( period = factor(period, c(&quot;before&quot;, &quot;after&quot;), ordered = T)) g &lt;- metrics_ba %&gt;% ggplot() + geom_boxplot(aes(x = metric, y = sentiment, fill = metric)) + facet_wrap(~period) ggplotly(g) The sentiments do not look significantly different before and after lockdown, especially relative to the dramatically different NO2 (blue). References "]
]
